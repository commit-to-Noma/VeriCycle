<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rewards & Proof - VeriCycle</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="dark-theme">
    {% include '_navbar.html' %}

    <main class="container app-dashboard">
        <div class="dashboard-header">
            <h2>Rewards & Proof of Income</h2>
            <p>See the value of your EcoCoin and create verifiable records of your hard work.</p>
        </div>

        <div class="rewards-grid">

            <div class="card" id="bank-mockup">
                <h3>EcoCoin-to-Rand Bridge</h3>
                <p class="mockup-subtitle">Redeem your EcoCoin directly to your bank account. (Pitch Mockup)</p>
                
                <div class="bank-app">
                    <div class="bank-header">
                        <span class="bank-logo">Standard Bank</span>
                        <span class="bank-time">11:45</span>
                    </div>
                    <div class="bank-body">
                        <h4>Redeem from VeriCycle</h4>

                        <div class="bank-account">
                            <span class="bank-label">From Wallet (Your Current Balance)</span>
                            <span class="bank-value" id="wallet-balance">-- ECO</span>
                        </div>
                        <div class="bank-account">
                            <span class="bank-label">To Account (Cheque)</span>
                            <span class="bank-value">... 1337</span>
                        </div>

                        <div class="bank-conversion">
                            <span class="bank-label">Redemption Amount: 500.00 ECO</span>
                            <span class="bank-total">ZAR 10.00</span>
                        </div>

                        <button class="bank-button" id="bank-button-redeem">Confirm Redemption (500 ECO)</button>
                    </div>
                </div>
            </div>

            <div class="card" id="bonus-mockup">
                <h3>Green Member Bonus</h3>
                <p class="mockup-subtitle">Your loyalty pays off. Unlock higher rates as your lifetime contribution grows.</p>

                <div class="tier-list">

                    <div class="tier-item active">
                        <span class="tier-icon">üçÉ</span>
                        <div class="tier-details">
                            <span class="tier-name">Green Member</span>
                            <span class="tier-desc">Your starting tier (0 - 50kg)</span>
                        </div>
                        <span class="tier-rate base-rate">VeriCycle Base Rate</span>
                    </div>

                    <div class="tier-item">
                        <span class="tier-icon">ü•â</span>
                        <div class="tier-details">
                            <span class="tier-name">Bronze Tier</span>
                            <span class="tier-desc">Unlock at 50kg Recycled</span>
                        </div>
                        <span class="tier-rate">+10% Bonus</span>
                    </div>

                    <div class="tier-item">
                        <span class="tier-icon">ü•à</span>
                        <div class="tier-details">
                            <span class="tier-name">Silver Tier (Your Current Tier)</span>
                            <span class="tier-desc">Unlock at 250kg Recycled</span>
                        </div>
                        <span class="tier-rate">+15% Bonus</span>
                    </div>

                    <div class="tier-item">
                        <span class="tier-icon">ü•á</span>
                        <div class="tier-details">
                            <span class="tier-name">Gold Tier</span>
                            <span class="tier-desc">Unlock at 500kg+ Recycled</span>
                        </div>
                        <span class="tier-rate">+20% Bonus</span>
                    </div>

                </div>
                <p class="bonus-note">Your tier is based on your total lifetime kilograms recycled on the VeriCycle network.</p>
            </div>

            <div class="card" id="proof-mockup">
                <h3>Verifiable Proof of Income</h3>
                <p class="mockup-subtitle">Download a formal PDF report of your income history for banks or credit applications.</p>
                
                <div class="pdf-icon">
                    <span>üìÑ</span>
                </div>
                <h4>EcoCoin Income Report: Nov 2025</h4>
                <p class="proof-note">This report contains all your HCS-verified transactions, providing an immutable, trustworthy record of your earnings.</p>
                
                <a href="{{ url_for('static', filename='sample_report.pdf') }}" target="_blank" class="btn-primary-large btn-form">Download PDF Report</a>
            </div>
        </div>
    </main>
    <script>
    document.addEventListener('DOMContentLoaded', function() {

        // --- 1. GET ALL THE ELEMENTS ---
        const redeemButton = document.getElementById('bank-button-redeem');
        const walletBalanceSpan = document.getElementById('wallet-balance');
        let currentData = null;

        // --- 2. LOAD YOUR *REAL* BALANCE INTO THE MOCKUP ---
        let storedData = localStorage.getItem('userBalance');
        if (storedData) {
            try {
                currentData = JSON.parse(storedData);
                // Update the "From Wallet" to show your actual, current balance
                if (typeof currentData.total_eco === 'number') {
                    walletBalanceSpan.textContent = `ECO ${currentData.total_eco.toFixed(2)}`;
                } else {
                    walletBalanceSpan.textContent = "ECO --";
                }
            } catch (err) {
                console.error('Invalid userBalance in localStorage', err);
                walletBalanceSpan.textContent = "ECO -- (Visit Dashboard first)";
            }
        } else {
            walletBalanceSpan.textContent = "ECO -- (Visit Dashboard first)";
            if (redeemButton) {
                redeemButton.disabled = true; // Disable button if no balance
                redeemButton.textContent = "Please visit Dashboard first";
            }
        }

        // --- 3. ADD THE NEW CLICK LOGIC ---
        if (redeemButton) {
            redeemButton.addEventListener('click', function(e) {
                e.preventDefault();

                if (!currentData) {
                    alert("Error: No balance data found. Please visit your dashboard.");
                    return;
                }

                const redeemAmount = 500; // Demo amount from PDF (updated)

                if (currentData.total_eco < redeemAmount) {
                    alert("You do not have enough EcoCoin to make this redemption.");
                    return;
                }

                // 1. Subtract the amount
                currentData.total_eco = currentData.total_eco - redeemAmount;

                // 2. Save the new, lower balance back to storage
                localStorage.setItem('userBalance', JSON.stringify(currentData));

                // 3. SHOW YOUR NEW SUCCESS MESSAGE!
                // Show a friendly transient message before redirecting
                alert("Redemption Successful!\n\nWe have requested your bank to deposit ZAR 10.00. This transaction will be completed within 24 hours. You will now be taken to your dashboard.");

                // 4. Redirect to the dashboard
                window.location.href = '/collector';
            });
        }
    });
    </script>
</body>
</html>