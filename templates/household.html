<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Household Dashboard - VeriCycle</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="dark-theme">
    {% include '_navbar.html' %}

    <main class="container">
      <h2>Household Dashboard</h2>

      <div class="card">
        <h3>Location</h3>
        <form method="POST" action="/household/set-location" style="display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
          <label for="location_id"><strong>Select location:</strong></label>
          <select name="location_id" id="location_id">
            {% for loc in locations %}
              <option value="{{ loc.id }}" {% if loc.id == selected_location_id %}selected{% endif %}>
                {{ loc.name }}{% if loc.city %}, {{ loc.city }}{% endif %}
              </option>
            {% endfor %}
          </select>
          <button type="submit">Update</button>
        </form>

        <p style="margin-top:10px;">
          Current: <strong>{{ location.name }}</strong>{% if location.city %}, {{ location.city }}{% endif %}
        </p>
        <p>Reliability Score: <strong>{{ "%.2f"|format(reliability_score) }}</strong></p>
        <p class="muted">Reliability updates after confirm/missed pickups (Phase 1 Day 19).</p>
      </div>

      <div class="card">
        <h3>This Week’s Waste Schedule</h3>
        <table>
          <thead>
            <tr>
              <th>Stream</th>
              <th>Pickup Day</th>
              <th>Window</th>
            </tr>
          </thead>
          <tbody>
            {% for row in schedules %}
            <tr>
              <td>{{ row.stream }}</td>
              <td>{{ row.day }}</td>
              <td>{{ row.window }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        <h3>Pickup Actions</h3>
        <form method="POST" action="/household/pickup-action" style="display:flex; gap:10px; flex-wrap:wrap; align-items:center;">
          <label for="stream"><strong>Stream:</strong></label>
          <select name="stream" id="stream">
            {% for row in schedules %}
              <option value="{{ row.stream }}">{{ row.stream }}</option>
            {% endfor %}
          </select>

          <button type="submit" name="action" value="confirmed">Confirm pickup</button>
          <button type="submit" name="action" value="missed">Mark missed</button>
        </form>

        <p class="muted">Records today’s pickup outcome for the selected stream (Phase 1 Day 19).</p>

        <h3>Recent Pickup Events</h3>
        <table>
          <thead>
            <tr><th>Date</th><th>Stream</th><th>Outcome</th></tr>
          </thead>
          <tbody>
            {% for e in recent_events %}
              <tr>
                <td>{{ e.scheduled_date }}</td>
                <td>{{ e.stream }}</td>
                <td>{{ e.outcome }}</td>
              </tr>
            {% else %}
              <tr><td colspan="3">No pickup events yet.</td></tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </main>

</body>
</html>
