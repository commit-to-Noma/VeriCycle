<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VeriCycle - Verified Value</title>
    <link rel="icon" type="image/png" href="{{ url_for('static', filename='logo.png') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body class="dark-theme">
    {% include '_navbar.html' %}

    <main class="hero">
        <div class="container">
            <h2>VeriCycle</h2>
            <h1>Verified Value.</h1>
            <p class="subtitle">Replacing an untrustworthy cash system with a verifiable ledger that protects both the collector and the center.</p>
            
            <a href="#our-mission" class="btn-secondary">Learn About Our Mission</a>
        </div>
    </main>

    <section class="cta-section">
        <div class="container">
            
            <h2>Join the VeriCycle Network</h2>
            <p class="cta-subtitle">
                Become a 'Green Member' today. Turn your recycling efforts into verifiable, secure, and valuable rewards.
            </p>
            
            <div class="advantages">
                <div class="advantage-card">
                    <h3>‚úÖ Get Paid Safely.</h3>
                    <p>Stop worrying about carrying cash. Your digital EcoCoin wallet is secure.</p>
                </div>
                <div class="advantage-card">
                    <h3>ü§ù Get Paid Fairly.</h3>
                    <p>Get a permanent, verifiable receipt for every drop-off. No more disputes.</p>
                </div>
                <div class="advantage-card">
                    <h3>üìà Build Your Future.</h3>
                    <p>Build a real, digital income history that can help you get bank loans.</p>
                </div>
                <div class="advantage-card">
                    <h3>üí∞ Earn More Than Cash.</h3>
                    <p>Unlock "Bulk Bonuses" and other incentives only available to our 'Green Members'.</p>
                </div>
            </div>

            {% if not current_user.is_authenticated %}
                <div class="cta-buttons">
                    <a href="#" class="btn-primary-large js-open-auth" data-form="signup">Create Your Account</a>
                    <p>
                        Already have an account? 
                        <a href="#" class="link-secondary js-open-auth" data-form="login">Log In here</a>
                    </p>
                </div>
            
            {% else %}
                <div class="cta-buttons">
                    <a href="{{ url_for('collector_dashboard') }}" class="btn-primary-large">Go to My Dashboard</a>
                </div>
            {% endif %}
        </div>
    </section>
    <section class="activity-feed-section">
        <div class="container">
            <div class="live-grid">

                <div class="leaderboard-column">
                    <h2>Top Neighborhoods</h2>
                    <p class="activity-subtitle">Well done to these areas for leading the way in Joburg!</p>

                    <div class="leaderboard-chart">
                        <div class="column-chart-container">
                            
                            <div class="chart-column-item">
                                <div class="chart-bar-viz" style="height: 92%;"></div>
                                <span class="chart-bar-label">Sandton</span>
                            </div>
                            
                            <div class="chart-column-item">
                                <div class="chart-bar-viz" style="height: 81%;"></div>
                                <span class="chart-bar-label">Randburg</span>
                            </div>

                            <div class="chart-column-item">
                                <div class="chart-bar-viz" style="height: 65%;"></div>
                                <span class="chart-bar-label">Soweto</span>
                            </div>

                            <div class="chart-column-item">
                                <div class="chart-bar-viz" style="height: 50%;"></div>
                                <span class="chart-bar-label">Roodepoort</span>
                            </div>

                        </div>
                    </div>
                    <p class="leaderboard-note">
                        üèÜ A huge congrats to <strong>Sandton</strong> for recycling <strong>12.4k kg</strong> and leading the charge!
                    </p>
                </div>

                <div class="live-feed-column">
                    <h2>Live Community Activity</h2>
                    <p class="activity-subtitle">See the latest verified drop-offs from Green Members.</p>
                    
                    <div class="activity-feed-container">
                        <div class="activity-feed" id="activity-feed">
                            </div>
                    </div>
                </div>

            </div> </div>
    </section>

    <section class="mission-section" id="our-mission">
        <div class="container">
            <h2>Our Mission & Impact</h2>
            <p class="activity-subtitle">VeriCycle is more than an app. It's a new economy for recycling.</p>

            <div class="advantages" style="grid-template-columns: 1fr; row-gap: 1.5rem;">

                <div class="advantage-card">
                    <h3>‚ùì The Problem We're Solving</h3>
                    <p>
                        South Africa's informal recycling sector is vital, but it's built on an untrustworthy, cash-based system. Collectors often get unfair prices, have no way to prove their income, and risk carrying cash. This traps people in a high-risk, low-reward cycle.
                    </p>
                </div>

                <div class="advantage-card">
                    <h3>‚úÖ The VeriCycle Solution</h3>
                    <p>
                        VeriCycle replaces cash with <strong>EcoCoin</strong>, a secure digital token. For every drop-off, a permanent, verifiable record is created on the Hedera network. This guarantees fair pay for collectors and gives centers a transparent, auditable log of their inventory.
                    </p>
                </div>

                <div class="advantage-card">
                    <h3>üìà The Real-World Impact</h3>
                    <p>
                        We empower collectors by building a "Proof of Income" report for bank loans. Our 'Green Member' bonuses pay <em>more</em> than cash, boosting the local economy and creating a powerful incentive to keep Joburg clean.
                    </p>
                </div>

            </div>
        </div>
    </section>

    <!-- 
      =====================================================
      THE POP-UP (MODAL)
      =====================================================
    -->
    <div class="modal-overlay" id="auth-modal">
        <div class="card modal-content">
            
            <button class="modal-close js-close-auth">&times;</button>

            <div id="flash-container">
                {% with messages = get_flashed_messages(with_categories=true) %}
                    {% if messages %}
                        {% for category, message in messages %}
                            <div class="flash-message {{ category }}">{{ message }}</div>
                        {% endfor %}
                    {% endif %}
                {% endwith %}
            </div>

            <!-- SIGN UP FORM -->
            <div id="signup-form">
                <h2>Create Your Account</h2>
                <form action="{{ url_for('signup') }}" method="POST" class="verify-form">
                    <div class="form-group">
                        <label for="signup-email">Email:</label>
                        <input type="email" id="signup-email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Password:</label>
                        <input type="password" id="signup-password" name="password" required>
                    </div>
                    <button type="submit" class="btn-primary-large btn-form">Create Account</button>
                </form>
                <p>
                    Already have an account? 
                    <a href="#" class="link-secondary js-toggle-auth">Log In</a>
                </p>
            </div>

            <!-- LOG IN FORM -->
            <div id="login-form" style="display: none;">
                <h2>Welcome Back</h2>
                <form action="{{ url_for('login') }}" method="POST" class="verify-form">
                    <div class="form-group">
                        <label for="login-email">Email:</label>
                        <input type="email" id="login-email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="login-password">Password:</label>
                        <input type="password" id="login-password" name="password" required>
                    </div>
                    <button type="submit" class="btn-primary-large btn-form">Log In</button>
                </form>
                <p>
                    Don't have an account? 
                    <a href="#" class="link-secondary js-toggle-auth">Sign Up</a>
                </p>
            </div>
            
        </div>
    </div>
    <!-- End of Modal -->

    <!-- 
      =====================================================
      THE "SMART" JAVASCRIPT
      =====================================================
    -->
    <script>
        const modal = document.getElementById('auth-modal');
        const allOpenButtons = document.querySelectorAll('.js-open-auth');
        const allCloseButtons = document.querySelectorAll('.js-close-auth');
        const allToggleLinks = document.querySelectorAll('.js-toggle-auth');
        
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const flashContainer = document.getElementById('flash-container');

        // Function to open the modal
        const openModal = function(e) {
            e.preventDefault(); 
            const targetForm = this.dataset.form; 
            if (targetForm === 'login') {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
            } else {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
            }
            modal.style.display = 'flex'; 
        };

        // Function to close the modal
        const closeModal = function(e) {
            e.preventDefault();
            modal.style.display = 'none'; 
            flashContainer.innerHTML = ''; 
        };

        // Function to toggle between login/signup
        const toggleForms = function(e) {
            e.preventDefault();
            if (loginForm.style.display === 'none') {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
            } else {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
            }
        };

        // Attach the functions to the buttons
        allOpenButtons.forEach(btn => btn.addEventListener('click', openModal));
        allCloseButtons.forEach(btn => btn.addEventListener('click', closeModal));
        allToggleLinks.forEach(link => link.addEventListener('click', toggleForms));

        // --- THIS IS THE FIX FOR BUG 1 (THE "UNPROVOKED POP-UP") ---
        // We only want to check for ERROR messages.
        const errorMessages = flashContainer.querySelectorAll('.flash-message.error'); // <--- THIS IS THE FIX
        
        if (errorMessages.length > 0) { // <--- THIS IS THE FIX
            modal.style.display = 'flex'; 
            
            const errorMsg = errorMessages[0].textContent;
            if (errorMsg.includes('Login') || errorMsg.includes('log in') || errorMsg.includes('must be logged in')) {
                loginForm.style.display = 'block';
                signupForm.style.display = 'none';
            } else {
                loginForm.style.display = 'none';
                signupForm.style.display = 'block';
            }
        }
        // --- END OF THE FIX ---
    </script>
    <script>
            document.addEventListener('DOMContentLoaded', function() {
                const feedElement = document.getElementById('activity-feed');
                
                // 1. Our fake data
                const fakeData = [
                    { icon: '‚ôªÔ∏è', text: '<strong>1.5kg</strong> of Cans verified at <strong>Pikitup Marlboro</strong>' },
                    { icon: '‚ôªÔ∏è', text: '<strong>2.1kg</strong> of Paper verified at <strong>Mpact Randburg</strong>' },
                    { icon: '‚ôªÔ∏è', text: '<strong>0.8kg</strong> of Glass verified at <strong>Roodepoort Recycling</strong>' },
                    { icon: '‚ôªÔ∏è', text: '<strong>3.0kg</strong> of Cardboard verified at <strong>Mpact Germiston</strong>' },
                    { icon: '‚ôªÔ∏è', text: '<strong>1.2kg</strong> of PET Bottles verified at <strong>FMSA Waltloo</strong>' },
                ];
                
                // 2. We need to double the data to make the scroll loop seamless
                const allData = [...fakeData, ...fakeData];
                
                // 3. Create the HTML for each item
                allData.forEach(item => {
                    const itemElement = document.createElement('div');
                    itemElement.className = 'activity-item';
                    itemElement.innerHTML = `
                        <span class="activity-icon">${item.icon}</span>
                        <span class="activity-text">${item.text}</span>
                    `;
                    feedElement.appendChild(itemElement);
                });
                
                // 4. Update the animation to scroll the correct distance
                const itemHeight = 61; // The height of one .activity-item (padding + text)
                const totalScrollHeight = fakeData.length * itemHeight;
                
                // We update the 'scroll-up' animation in the CSS
                // This is a bit advanced, but it works!
                document.styleSheets[0].insertRule(`
                    @keyframes scroll-up {
                        0% { transform: translateY(0); }
                        100% { transform: translateY(-${totalScrollHeight}px); }
                    }
                `, document.styleSheets[0].cssRules.length);
            });
    </script>
</body>
</html>